# 要件定義書 - 旅行管理アプリ（Travue）

## 1. 目的

旅行先のランドマークや地域情報、ユーザーの写真・レビュー・Tipsを蓄積し、  
それらをもとに**誰でもテーマ別ガイドブックを作成・共有できるモバイルアプリ**。

ターゲットは「旅を通じて自分のセンスを発信したいユーザー（自己表現型）」。

## 2. 主なユースケース

- 地図上から観光スポットやランドマークを探す
- 写真付きでレビューや豆知識を投稿
- 他人の投稿を組み合わせて「ガイドブック」を作成
- 「25歳女子向け」「40代男性のジョギングコース」などテーマ特化型
- OGP付きでガイドブックをSNS共有
- 地域や通貨、治安などの基本情報も表示

## 3. 機能要件

### 3.1 必須機能

- [ ] **ユーザー認証・管理機能**
  - 新規登録（メールアドレス、Google、Apple）
  - ログイン・ログアウト
  - プロフィール管理
  - パスワードリセット

- [ ] **旅行計画機能**
  - 新規旅行プランの作成・編集・削除
  - 旅行期間の設定（開始日・終了日）
  - 旅行先の設定（複数都市対応）
  - 旅行メンバーの招待・管理

- [ ] **場所・スポット管理機能**
  - 訪問予定地の追加・編集・削除
  - 地図上での場所の表示・検索
  - スポット情報（住所、営業時間、評価など）
  - カテゴリ分類（観光地、レストラン、宿泊施設など）

- [ ] **スケジュール管理機能**
  - 日別・時間別スケジュールの作成
  - 移動時間の考慮
  - スケジュールの変更・調整機能

- [ ] **記録・メモ機能**
  - 写真の撮影・保存・整理
  - テキストメモの作成・編集
  - 評価・レビューの記録
  - 支出記録（費用管理）

- [ ] **データ同期機能**
  - クラウドでのデータ保存
  - デバイス間でのデータ同期
  - オフライン時のローカル保存

### 2.2 オプション機能

- [ ] **AI推奨機能**
  - 過去の旅行履歴に基づく場所の推奨
  - 天気情報に基づくスケジュール提案

- [ ] **共有機能**
  - 旅行記録のSNS共有
  - 友人との旅行プラン共有
  - 公開旅行記録の閲覧

- [ ] **通知機能**
  - スケジュール通知
  - 天気アラート
  - 交通情報通知

- [ ] **高度な分析機能**
  - 旅行統計（訪問国数、総移動距離など）
  - 支出分析・予算管理
  - 旅行パターン分析

## 4. 非機能要件

### 4.1 パフォーマンス

- アプリ起動時間：3秒以内
- 画面遷移：1秒以内
- 写真アップロード：10MB以下で30秒以内
- オフライン→オンライン時のデータ同期：5分以内

### 4.2 セキュリティ

- ユーザー認証情報の暗号化
- HTTPS通信の必須化
- 個人情報の適切な匿名化
- GDPR・個人情報保護法への準拠

### 4.3 保守性

- コードカバレッジ80%以上
- 明確なアーキテクチャ設計（Clean Architecture）
- 十分なドキュメント作成
- 継続的インテグレーション（CI/CD）

### 4.4 互換性

- iOS 13.0以上対応
- Android API Level 21以上対応
- レスポンシブデザイン（各種画面サイズ対応）
- 多言語対応（日本語・英語）

##  画面一覧（MVP想定）

1. **ホーム画面**  
   - 人気ガイドブック / 投稿者の表示
   - タグ・カテゴリ別検索

2. **地図画面**  
   - OSMベースのマップにピン表示（ランドマーク / 投稿）
   - 絞り込み・カテゴリ切替・ユーザー投稿への導線

3. **ランドマーク詳細画面**  
   - Wikipedia抽出＋ユーザー投稿＋地域情報（通貨、治安など）

4. **投稿作成画面**  
   - 写真・レビュー・Tipsの投稿
   - ランドマークまたは新規地点に紐付け

5. **ガイドブック作成画面**  
   - スポットを選んで並べ替え、表紙・タイトルを設定
   - タグ（対象層・テーマ）とともに公開 or 非公開選択

6. **ガイドブック閲覧画面**  
   - 表紙＋構成済スポットのリスト（＋地図連動）

7. **プロフィール画面**  
   - 自作ガイドブック一覧 / 投稿履歴 / フォロー数など

8. **検索・タグ画面（補助）**

## 🧩 データ構造（概要）

### テーブル構成（PostgreSQL）

- `users`：ユーザー情報（Supabase Auth連携）
- `landmarks`：観光地・施設の基本情報＋地理座標（Point）
- `posts`：レビュー投稿（ランドマークID、写真、テキスト）
- `regions`：国・都市など地域情報（通貨、SIM、治安など）
- `guides`：ガイドブック（タイトル、表紙、対象層、公開設定）
- `guide_items`：ガイドブック内のスポット構成（順序付き）
- `areas`：エリア（Polygon）、旧市街などの囲い
- `routes`：線情報（LineString）、ジョギングコース等

## 🌍 空間検索（PostGIS）

- **半径検索**：`ST_DWithin(geography(Point), geography(Point), radius)`
- **ポリゴン内検索**：`ST_Within(Point, Polygon)`
- **線の距離計算**：`ST_Length(geography(LineString))`
- **Flutterからの呼び出し**：Supabase `rpc()` 経由

## 🔓 認証・公開範囲

- ガイドブック：公開／非公開／限定リンク（将来拡張）
- 投稿・エリア・ルートの編集：作成ユーザーに紐付け
- SNSシェア：OGP付きWebビュー or 動画生成（後工程）

## 📷 ストレージ構成案

- `/photos/{user_id}/{post_id}/{filename}`：レビュー投稿用写真
- `/guides/{guide_id}/cover.jpg`：ガイドブック表紙

## 📊 UIのトーン

- 雑誌風・インスタ風に「映える」見せ方を重視
- 自分の世界観・旅のスタイルが表現できる「作品」志向
- ユーザーが“旅の編集者”になれるような設計

## 🧪 PoC段階での優先実装項目

1. 地図画面でランドマーク表示（ピン＋カード）
2. 投稿機能（写真＋テキスト＋ランドマーク紐付け）
3. ガイドブック作成画面（タイトル＋スポット並び替え）
4. 公開されたガイドブック閲覧画面
5. 認証（Supabase Auth）＋プロフィール表示

## 🧭 備考

- データ取得元：OpenStreetMap / Wikipedia API / Google Place API（必要に応じて）
- PostGISは Supabase において**すでに有効化済**のため、追加インストール不要
- 地図上での描画は Flutter 側（`flutter_map`）で処理し、WKT形式などで送信

## 5. 制約事項

### 5.1 技術的制約

## 🧱 技術スタック

| レイヤー | 技術 |
|---|---|
| クライアント | Flutter |
| 地図描画 | `flutter_map` + OpenStreetMap |
| バックエンド | Supabase（PostgreSQL + PostGIS） |
| ストレージ | Supabase Storage（S3互換） |
| 認証 | Supabase Auth（email, OAuth, magic link） |
| AI要約／生成（将来拡張） | Supabase Edge Functions または外部API |

### 4.2 ビジネス制約

- 初期開発期間：3ヶ月
- 初期リリース：MVP（最小限の機能）
- 外部API利用コストの考慮
- アプリストア審査要件への準拠

## 6. 成功基準

### 6.1 完了の定義

- [ ] **機能完成度**: 必須機能の100%実装
- [ ] **品質基準**: バグ密度1%以下
- [ ] **パフォーマンス**: 上記非機能要件の達成
- [ ] **ユーザビリティ**: ユーザーテストでの満足度80%以上
- [ ] **デプロイメント**: App Store・Google Play Storeでの公開準備完了

### 6.2 受け入れテスト

- 実際の旅行シナリオでのエンドツーエンドテスト
- 複数デバイスでのデータ同期確認
- オフライン・オンライン切り替え時の動作確認
- セキュリティテストの実施

## 7. 想定されるリスク

- **技術リスク**
  - Flutter + Supabaseの学習コスト
  - 外部API（地図、天気など）の利用制限
  - データ同期時の競合状態処理

- **ビジネスリスク**
  - 競合アプリとの差別化
  - ユーザー獲得・定着率
  - 外部サービス依存によるサービス継続性

- **対策**
  - プロトタイプでの技術検証
  - 段階的リリース（MVP → 機能拡張）
  - バックアップ計画の策定

## 8. 今後の検討事項

- **設計フェーズ**
  - データベーススキーマ設計
  - API設計（Supabase Functions）
  - UI/UX詳細設計
  - アーキテクチャ詳細設計

- **開発フェーズ**
  - 開発環境・CI/CD環境構築
  - テスト戦略・自動化
  - リリース戦略
  - 運用・監視体制